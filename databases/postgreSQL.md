---
title: PostgreSQL¶
url: https://docs.amvera.ru/databases/postgreSQL.html
path: databases/postgreSQL
prev: Сетевое взаимодействие
next: SQLite
---

# PostgreSQL¶

## Содержание

- PostgreSQL
- Разворачивание managed-кластера
- Подключение к кластеру
- Развертывание pgAdmin
  - 1. Создать преднастроенный сервис с подходящим тарифом.
  - 4. Указать необходимые параметры окружения.
- Настройка pgAdmin
- Бэкапы
  - Бэкапы по расписанию
  - Бэкапы по клику
- Восстановление кластера

---

Back to top

[ View this page ](<../_sources/databases/postgreSQL.md.txt> "View this page")

Toggle Light / Dark / Auto color theme

Toggle table of contents sidebar

__

# PostgreSQL

Облако Amvera поддерживает создание управляемого кластера postgres с одной или несколькими запущенными репликами СУБД. Создание кластера происходит в несколько простых шагов:

## Разворачивание managed-кластера
1. На главной странице выбрать «PostgreSQL»
2. Нажать на кнопку «Создать базу данных».
3. Задать «Название проекта», выбрать подходящий тариф. ![postgresql-new](images/postgresql.png)

> **ATTENTION** > > Внимание Стабильная работа возможна на тарифах не ниже «Начальный». 
4. Задать параметры СУБД PostgreSQL

> **ATTENTION** > > Внимание Имя базы данных и имя пользователя postgres зарезервировано и не могут быть указаны. 
* ``Имя создаваемой БД`` \- имя для базы данный, которая будет создана в кластере.
* ``Имя пользователя`` \- имя для пользователя, под которым будет реализовываться вход в СУБД.
* ``Пароль пользователя`` \- пароль для указанного выше пользователя, под которым будет реализовываться вход в СУБД.
* ``Размер кластера СУБД`` \- количество реплик СУБД. При этом одна из реплик будет мастером и в связи с особенностями СУБД доступ на запись будет доступен только через неё.

> **⚠️ Предупреждение** > > Важно Тарификация происходит отдельно за каждую реплику согласно выбранному тарифу 
* ``Активировать Superuser Access`` \- активировать доступ суперпользователя с именем пользователя ``postgres``.
* ``Пароль для Superuser`` \- пароль для пользователя ``postgres``, под которым возможен вход в СУБД с правами суперпользователя.
5. Нажать кнопку «Завершить» и дождаться перехода кластера в статус «PostgreSQL запущен».

## Подключение к кластеру

Для доступа к базе данных из других проектов Амвера достаточно указать одно из трех доменных имен:
* Для чтения/записи: ``amvera-<username>-cnpg-<project_name>-rw``
* Только для чтения в режиме hot standby: ``amvera-<username>-cnpg-<project_name>-ro``
* Для чтения с произвольной из развернутых нод: ``amvera-<username>-cnpg-<project_name>-r``

Для доступа к базе данных из сети Интернет необходимо создать [доменное имя](<../applications/configuration/network.html>) с типом POSTGRES. Клиент, которым будет выполняться подключения к БД должен поддерживать SSL.

> **ATTENTION** > > Важно При подключении из локального pgAdmin, укажите это доменное имя без https вначале. 

В pgAdmin Desktop указывается
* Host name: ``<project_name>-<username>.db-msk0.amvera.tech``
* SSL mode: ``prefer``

> **ATTENTION** > > Внимание Рекомендуется использовать версию pgAdmin не выше 8.12, поскольку версии выше используют v17 libpq. Именно на этой версии при попытке подключиться к БД возвращается ошибка SSL error: tlsv1 alert no application protocol. 

> **ATTENTION** > > Внимание Если у вас не получается подключиться с использованием pgAdmin, используйте DBeaver. 

## Развертывание pgAdmin

Видео в VK Video для просмотра без VPN доступно по [ссылке](<https://vkvideo.ru/video-167699755_456239042>).

Видео в YouTube:

### 1\. Создать преднастроенный сервис с подходящим тарифом.
1. На главной странице выбираем «Преднастроенные сервисы»
2. Нажимаем кнопку «Создать преднастроенный сервис» и задаем «Утилиты для баз данных» как параметры сервиса и «pgAdmin» как тип сервиса.
3. Жмем далее и вводим произвольное название проекта

> **ATTENTION** > > Внимание Для работы pgadmin требуется контейнер с тарифом не ниже «Начальный». 

### 4\. Указать необходимые параметры окружения.

При развертывании используется [образ](<https://hub.docker.com/r/dpage/pgadmin4>) Docker ``dpage/pgadmin4:${meta.toolchain.version}``

> **ATTENTION** > > Внимание Рекомендуется использовать версию не выше 8.12, поскольку версии выше используют v17 libpq. Именно на этой версии при попытке подключиться к БД возвращается ошибка SSL error: tlsv1 alert no application protocol. 

В разделе «Переменные» у проекта необходимо задать следующие [переменные окружения](<../applications/configuration/variables.html>):
* Переменная ``PGADMIN_DEFAULT_EMAIL`` \- почта администратора pgAdmin
* Секрет ``PGADMIN_DEFAULT_PASSWORD`` \- пароль для доступа к pgAdmin (не имеет ничего общего с паролем от БД)

## Настройка pgAdmin
1. В разделе «Настройки» приложения активируем [бесплатное доменное имя](<../applications/configuration/network.html#бесплатное-доменное-имя-амвера>) или [добавляем свое](<../applications/configuration/network.html#свое-доменное-имя>). ![db_create](images/pgadmin_domain_1.png)
2. Дожидаемся окончания привязки доменного имени и переходим по нему.
3. Вводим данные для входа в pgAdmin.
4. Слева правой кнопкой мыши Server->Register->Server…
5. В окне в разделе General указываем название для подключаемой БД. В разделе Connection указываем:
* Host name/address - внутреннее доменное имя проекта с postgreSQL. Внутреннее доменное имя вы можете найти на странице «Инфо» СУБД.
* Maintenance database - название БД (по умолчанию ``postgres``)
* Username - имя пользователя, которое указывалось на этапе создания СУБД (если был активирован Superuser, то может быть как ваш, так и``postgres``). Важно учесть регистр.
* Password - пароль указанного выше пользователя. Важно учесть регистр.
6. Нажимаем кнопку «Save»

> **HINT** > > Хитрость Чтобы экономить на потреблении проекта с pgAdmin рекомендуем ставить его на паузу после окончания работы. 

## Бэкапы

### Бэкапы по расписанию

Сервис предоставляет возможность создания бесплатных бэкапов по расписанию. Бэкапы начнут создаваться со следующего дня в час их активации. Сервис хранит крайние **три** бэкапа.

> **⚠️ Предупреждение** > > Важно После остановки кластера ежедневные бэкапы будут отключены. Не забудьте активировать их после запуска кластера. 

### Бэкапы по клику

Для создания бэкапа нажмите на кнопку «Создать бэкап» и введите его описание, чтобы отличить его от других. Имя бэкапа будет сгенерировано автоматически.

Максимально вы можете создать **три** бэкапа, они также являются бесплатными.

![backups](images/postgresql_backups.png)

## Восстановление кластера

> **ATTENTION** > > Внимание После восстановления кластера будет создан новый сервис. Для подключения к восстановленному кластеру не забудьте изменить url в вашем проекте. Пользователь и пароли будут восстановлены автоматически. 

Восстановить кластер можно по клику на иконку необходимого бэкапа.

Если восстановление идет более 20 минут (время зависит от размера БД), то обратитесь в поддержку.

![restore](images/postgresql_restore.png)

[ Next SQLite ](<sqlite.html>) [ Previous Сетевое взаимодействие ](<../applications/configuration/network.html>)

Copyright © 2024, Amvera 

Made with [Sphinx](<https://www.sphinx-doc.org/>) and [@pradyunsg](<https://pradyunsg.me>)'s [Furo](<https://github.com/pradyunsg/furo>)


---

### Навигация

← [Сетевое взаимодействие](applications/configuration/network.md)

→ [SQLite](sqlite.md)
